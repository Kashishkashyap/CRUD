const express= require('express');
const mongoose= require('mongoose');
const methodOverride= require('method-override');
const app= express();

const path= require('path')

const Product= require('./model/products');

mongoose.connect('mongodb+srv://kashyapkashish22:kashish22@fleksa.7hxli5u.mongodb.net/?retryWrites=true&w=majority',{
    useNewUrlParser: true,
    useUnifiedTopology:true
})

const db = mongoose.connection;
db.on('error', console.error.bind(console, 'connection error:'));
db.once('open', function() {
  console.log("DataBase Connected");
});


app.set('view engine','ejs');
app.set('views',path.join(__dirname,'views'));

app.use(express.urlencoded({extended:true}))
app.use(methodOverride('_method'));

app.get('/',(req,res)=>{
    res.render("home")
})
app.get('/makeproduct',async(req,res)=>{
    const product= new Product({title: 'Rose', description:'rose seeds', price:'50', image:'data:image/jpeg;base64,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'});
    await product.save();
    res.send(product);

})
app.get('/products',async(req,res)=>{
        const products= await Product.find();
        res.render('products/index',{products});

})
app.get('/products/new',async(req,res)=>{
        res.render('products/new');

})
app.post('/products',async(req,res)=>{
    const newProduct= new Product(req.body.product);
        await newProduct.save();
    res.redirect(`/products/${newProduct._id}`)

})
app.get('/products/:id',async(req,res)=>{
    const product=await Product.findById(req.params.id)
    // res.send("submitted")
    res.render('products/show',{product});
})
app.get('/products/:id/edit',async(req,res)=>{
    const product=await Product.findById(req.params.id)
    res.render('products/edit',{product});
})
app.put('/products/:id',async(req,res)=>{
    const product=await Product.findByIdAndUpdate(req.params.id,{...req.body.product});
    res.redirect(`/products/${product._id}`)
})
app.delete('/products/:id',async(req,res)=>{
    const {id}=req.params;
    await Product.findByIdAndDelete(id);
    res.redirect('/products');
})
app.listen(3000,()=>{
    console.log("Port 3000")
})